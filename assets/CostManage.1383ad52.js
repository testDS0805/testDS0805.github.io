import{r as l,R as s}from"./index.da6908f5.js";import{m as d,o as J,c as _,u as j,h as D,P as q,B as C,r as T,A as Z,C as ee,f as te,d as b,i as ae,D as se}from"./App.11263b70.js";import{g as oe}from"./GridCtrl.5c3948f6.js";import{C as ue}from"./CommonButton.0b792d77.js";import{T as ie}from"./Toast.7cbbb43f.js";const re=[{fieldName:"No",dataType:d.exports.ValueType.NUMBER},{fieldName:"RegisterDate",dataType:d.exports.ValueType.DATE,datetimeFormat:"yyyyMMdd"},{fieldName:"GoodNo",dataType:d.exports.ValueType.TEXT},{fieldName:"Amount",dataType:d.exports.ValueType.NUMBER},{fieldName:"Qty",dataType:d.exports.ValueType.NUMBER},{fieldName:"Description",dataType:d.exports.ValueType.TEXT},{fieldName:"Credate",dataType:d.exports.ValueType.DATE,datetimeFormat:"yyyyMMdd"}],ne=[{name:"RegisterDate",fieldName:"RegisterDate",type:"data",width:120,editable:!1,header:{text:"\uB4F1\uB85D\uC77C\uC790"},renderer:{type:"text",showTooltip:!1}},{name:"GoodNo",fieldName:"GoodNo",type:"data",width:250,editable:!0,styleName:"left-column",button:"action",header:{text:"*\uD488\uBC88"},renderer:{type:"text",showTooltip:!1},editor:{type:"line",textCase:"upper"}},{name:"Qty",fieldName:"Qty",type:"data",width:100,editable:!0,styleName:"right-column",header:{text:"*\uC218\uB7C9"},numberFormat:"#,##0",renderer:{type:"text",showTooltip:!0},editor:{type:"number"}},{name:"Amount",fieldName:"Amount",type:"data",width:100,editable:!0,styleName:"right-column",header:{text:"*\uC6D0\uAC00"},numberFormat:"#,##0",renderer:{type:"text",showTooltip:!0},editor:{type:"number"}},{name:"Description",fieldName:"Description",type:"data",width:900,editable:!0,styleName:"left-column",header:{text:"Description"},renderer:{type:"text",showTooltip:!1}}],De=J(()=>{const{$CommonStore:c,$UserStore:I}=j(),p=le(),g="COSTMANAGE",M=l.exports.useRef(null),[m,x]=l.exports.useState({frDate:new Date,toDate:new Date,goodNo:""}),[A,G]=l.exports.useState(0),[f,v]=l.exports.useState({visible:!1,description:"",value:"",datas:{},id:"",viewId:"",selectedData:{}}),[S,R]=l.exports.useState({visible:!1,desc:"",type:"N"}),[N,r]=l.exports.useState({visible:!1,desc:"",type:"N"}),[E,w]=l.exports.useState({visible:!1,desc:"",id:""});let y={...se};y.iInId="A111",y.iInCode1="001",y.iInCode2="00A",y.iInCode3="";const L=()=>{n=new d.exports.LocalDataProvider(!1),t=new d.exports.GridView(M.current),t.setDataSource(n),n.setFields(re),t.setColumns(ne),t.setCheckBar({visible:!0,width:35}),t.setStateBar({visible:!0}),t.setFooters({visible:!1}),t.setRowIndicator({visible:!0}),t.setDisplayOptions({fitStyle:"evenFill",rowHeight:25}),t.setOptions({summaryMode:"aggregate"}),t.setEditOptions({insertable:!0,appendable:!0,editable:!0}),t.onKeyDown=async function(e,a){let u=a.key,i=e.getItemCount();const o=n.getAllStateRows().created;(u==="ArrowRight"||u==="ArrowLeft"||u==="ArrowDown")&&e.commit(),u==="Enter"?(e.commit(!0),e.setFocus()):u==="Escape"&&i>0&&(e.cancel(),o.length!==0&&n.getRowState(e.getCurrent().itemIndex)!=="none"&&n.removeRow(e.getCurrent().itemIndex))},t.onCellButtonClicked=H,G(A+1)},H=async(e,a)=>{e.commit(!0);const u=e.getCurrent().itemIndex,i=a.fieldName;if(i==="GoodNo"){const h=e.getValue(u,i);if(!h){r({visible:!0,desc:"\uD488\uBC88 \uC785\uB825 \uD6C4 \uC870\uD68C \uAC00\uB2A5\uD569\uB2C8\uB2E4."});return}let o={};y.iInCode3=h,o=await oe(e.getCurrent(),y,g,h,!0),v(o)}},K=async()=>{t.commit();const e=f.selectedData;e.column==="GoodNo"&&n.setValue(e.dataRow,e.column,c.Codeclass.selData.goodno),t.commit(),v({visible:!1,desc:"",value:"",datas:{},selectedData:{},id:"",viewId:""}),t.setFocus()},O=()=>{const e=t.getCurrent().itemIndex;t.setCurrent({itemIndex:e,fieldName:"GoodNo"}),t.setFocus(),v({visible:!1})},k=e=>g+"_"+e,P=e=>{x(a=>({...a,frDate:e}))},z=e=>{x(a=>({...a,toDate:e}))},Q=(e,a)=>{x(u=>({...u,[a]:e}))},F=async()=>{t.beginAppendRow(),t.showEditor(),t.setFocus()},B=async()=>{if(t.cancel(),!D(m.frDate,"YYYY-MM-DD").isValid()||!D(m.toDate,"YYYY-MM-DD").isValid()){r({visible:!0,desc:"\uB4F1\uB85D\uC77C \uAC80\uC0C9\uAE30\uAC04\uC744 \uBC14\uB974\uAC8C \uC785\uB825\uD574 \uC8FC\uC138\uC694."});return}if(D(m.frDate).format("YYYYMMDD")>D(m.toDate).format("YYYYMMDD")){r({visible:!0,desc:"\uB4F1\uB85D\uC77C \uAC80\uC0C9\uAE30\uAC04\uC744 \uD655\uC778\uD574 \uC8FC\uC138\uC694."});return}let e={...m};e.frDate=D(e.frDate).format("YYYYMMDD"),e.toDate=D(e.toDate).format("YYYYMMDD"),W(),n.setRows([]);try{let a=await b.get("/@api/cost/costmanage/selectByList",{params:e});n.setRows(a.data)}catch(a){a.response.status===404?r({visible:!0,desc:"\uC870\uD68C \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."}):r({visible:!0,desc:"\uC870\uD68C\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4.",type:"E"})}},Y=async()=>{t.commit();const e=n.getAllStateRows(),a=e.created,u=e.updated;if(a.length===0&&u.length===0){r({visible:!0,desc:"\uC800\uC7A5\uD560 \uC790\uB8CC \uB610\uB294 \uC218\uC815\uD560 \uC790\uB8CC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4"});return}w({visible:!0,desc:"\uC800\uC7A5 \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",id:"SAVE"})},U=async()=>{const e=n.getAllStateRows(),a=e.created,u=e.updated;try{if(a.length>0){let i=[];if(a.map(o=>{i.push(t.getValues(o))}),i.find(o=>!o.Qty||!o.Amount||!o.GoodNo)){r({visible:!0,desc:"\uD544\uC218\uAC12\uC744 \uC785\uB825\uD558\uC5EC \uC8FC\uC138\uC694."});return}await b.post("/@api/cost/costmanage/insertByList",{data:i,params:{userId:I.user.userid}}),i=[]}if(u.length>0){let i=[];if(u.map(o=>{i.push(t.getValues(o))}),i.find(o=>!o.Qty||!o.Amount||!o.GoodNo||!o.GoodNo)){r({visible:!0,desc:"\uD544\uC218\uAC12\uC744 \uC785\uB825\uD558\uC5EC \uC8FC\uC138\uC694."});return}await b.post("/@api/cost/costmanage/updateByList",{data:i,params:{userId:I.user.userid}}),i=[]}R({visible:!0,desc:"\uC800\uC7A5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),B()}catch{r({visible:!0,desc:"\uC800\uC7A5\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4.",type:"E"})}},V=async()=>{if(t.commit(),t.getCheckedRows(!0).length===0){r({visible:!0,desc:"\uC0AD\uC81C\uD560 \uC790\uB8CC\uB97C \uCCB4\uD06C \uD558\uC2ED\uC2DC\uC624"});return}w({visible:!0,desc:"\uC120\uD0DD \uC790\uB8CC\uB97C \uC0AD\uC81C \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",id:"DELETE"})},$=async()=>{try{let e=[];t.getCheckedRows(!0).map(a=>{e.push(n.getJsonRow(a))}),await b.post("/@api/cost/costmanage/deleteByList",{data:e}),e=[],r({visible:!0,desc:"\uC0AD\uC81C\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),B()}catch{r({visible:!0,desc:"\uC0AD\uC81C\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4.",type:"E"})}},W=()=>{t.orderBy([],[])},X=async()=>{E.id==="SAVE"?U():E.id==="DELETE"&&$(),w({visible:!1,desc:"",id:""})};return l.exports.useEffect(()=>{A>0&&B()},[A]),l.exports.useEffect(()=>{c.HotKey&&c.HotKey.pgmid===g&&(c.HotKey.key==="NEW"?F():c.HotKey.key==="SEARCH"?B():c.HotKey.key==="SAVE"?Y():c.HotKey.key==="DELETE"&&V())},[c.HotKey]),l.exports.useEffect(()=>{const e=D().add(-1,"Y");x(a=>({...a,frDate:e.toDate()})),L()},[]),s.createElement(s.Fragment,null,s.createElement(ue,{pgmid:g,visible:"11110",onNew:F,onSearch:B,onSave:Y,onDelete:V}),s.createElement(q,{className:"mainCon"},s.createElement(C,{style:{width:"100%",height:50,backgroundColor:"#f9f9f9",borderRadius:"5px",display:"flex",flexDirection:"row",padding:5}},s.createElement(C,{style:{display:"flex",alignItems:"center"}},s.createElement(C,{className:p.S1},s.createElement(C,{className:p.S2},"\uB4F1\uB85D\uC77C\uC790")),s.createElement(C,{style:{display:"flex",alignItems:"center"}},s.createElement(T.exports.DateBox,{style:{width:110,height:25},className:p.S3,inputId:k("sDate"),lo:"ko",format:"yyyy-MM-dd",panelStyle:{width:250,height:250},value:m.frDate,onChange:e=>P(e),currentText:"\uC624\uB298",closeText:"\uB2EB\uAE30",okText:"\uD655\uC778"}),s.createElement(C,{style:{margin:"0 10px",width:"10px"}},"~"),s.createElement(T.exports.DateBox,{style:{width:110,height:25},className:p.S3,inputId:k("eDate"),format:"yyyy-MM-dd",panelStyle:{width:250,height:250},value:m.toDate,onChange:e=>z(e),currentText:"\uC624\uB298",closeText:"\uB2EB\uAE30",okText:"\uD655\uC778"})),s.createElement(C,{className:p.S1},s.createElement(C,{className:p.S2},"\uD488\uBC88\uCF54\uB4DC")),s.createElement(T.exports.TextBox,{placeholder:"\uD488\uBC88\uCF54\uB4DC",className:p.S4,value:m.goodNo,onChange:e=>Q(e,"goodNo")}))),s.createElement(C,{ref:M,style:{width:"100%",height:720,marginTop:5}})),s.createElement(ie,{visible:S.visible,description:S.desc,type:S.type,onConfirm:()=>R({visible:!1})}),s.createElement(Z,{visible:N.visible,description:N.desc,type:N.type,onConfirm:()=>r({visible:!1})}),s.createElement(ee,{visible:E.visible,description:E.desc,onCancel:()=>w({visible:!1}),onConfirm:X}),s.createElement(te,{visible:f.visible,description:f.desc,value:f.value,datas:f.datas,id:f.id,viewId:f.viewId,selectedData:f.selectedData,onConfirm:K,onCancel:O}))});let n,t;const le=_({S1:{margin:"3px 10px",backgroundColor:"#e0ecff",color:"#163971",padding:5,height:25,fontSize:"12px",display:"flex",alignItems:"center",width:110,fontWeight:600},S2:{width:100},S3:{"& .textbox-text":{fontSize:"12px"},"& .textbox":{fontSize:"12px"},"& .combo-arrow":{backgroundImage:`url(${ae})`,backgroundRepeat:"no-repeat",backgroundColor:"#ffffff!important",height:12}},S4:{width:185,height:25,"& input":{fontSize:"12px !important"}},S5:{width:100,height:25,"& input":{fontSize:"12px !important"}},S6:{width:90,height:30,color:"#fff",borderRadius:3,paddingBottom:2},S7:{width:"15px!important",height:"15px!important"},S8:{width:65,height:20,margin:"0px 3px",display:"flex",alignItems:"center",fontSize:12}});export{De as default};
