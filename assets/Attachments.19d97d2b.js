import{R as e,r as y}from"./index.da6908f5.js";import{G as _,o as b,c as U,B as n,r as g,m as x,u as R,U as I,A as z,d as N,q}from"./App.11263b70.js";function W(o){return _({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M7 9h2v-4h3l-4-4-4 4h3zM10 6.75v1.542l4.579 1.708-6.579 2.453-6.579-2.453 4.579-1.708v-1.542l-6 2.25v4l8 3 8-3v-4z"}}]})(o)}function H(o){return _({tag:"svg",attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M14 8h-2.5l-3.5 3.5-3.5-3.5h-2.5l-2 4v1h16v-1l-2-4zM0 14h16v1h-16v-1zM9 5v-4h-2v4h-3.5l4.5 4.5 4.5-4.5h-3.5z"}}]})(o)}const X=b(({FileTitle:o,FileType:B,FileNo:c,RevNo:m,IsRevision:d,onUploadFile:D,onDownloadFile:u})=>{const r=$();return e.createElement(e.Fragment,null,e.createElement(n,{style:{display:"flex",alignItems:"center"}},e.createElement(n,{style:{display:"flex",flexDirection:"column",width:"100%"}},e.createElement(n,{style:{width:"100%",height:40,display:"flex",flexDirection:"row",alignItems:"center",backgroundColor:"#f1efea"}},e.createElement(n,{className:r.DateTitleBox,style:{marginLeft:5}},"\uD30C\uC77C\uAD6C\uBD84"),e.createElement(g.exports.TextBox,{value:B,className:r.TextBox3,disabled:!0}),e.createElement(n,{className:r.DateTitleBox2,style:{marginLeft:5}},o),e.createElement(g.exports.TextBox,{value:c,className:r.TextBox4,disabled:!0}),d&&e.createElement(n,{style:{display:"flex"}},e.createElement(n,{className:r.DateTitleBox,style:{marginLeft:5}},"\uB9AC\uBE44\uC804 \uBC88\uD638"),e.createElement(g.exports.TextBox,{value:m,className:r.TextBox3,disabled:!0})),e.createElement(g.exports.FileButton,{style:{width:110,height:23,borderRadius:3,marginLeft:d===!0?20:150},onSelect:C=>D(C),multiple:!0,onClick:C=>{C.target.value=null}},e.createElement(n,{style:{width:100,display:"flex",alignItems:"center",justifyContent:"center"}},e.createElement(W,{size:18}),e.createElement(n,{style:{marginLeft:5,fontSize:12,paddingBottom:2,fontWeight:500}}," \uD30C\uC77C \uC5C5\uB85C\uB4DC"))),e.createElement(g.exports.LinkButton,{style:{width:110,height:23,color:"#424242",borderRadius:3,marginLeft:10},onClick:u},e.createElement(n,{style:{width:100,display:"flex",alignItems:"center",justifyContent:"center"}},e.createElement(H,{size:18}),e.createElement(n,{style:{marginLeft:5,fontSize:12,paddingBottom:2,fontWeight:500}}," \uC804\uCCB4 \uB2E4\uC6B4\uB85C\uB4DC")))))))}),j={BoxTitle:{backgroundColor:"#fccf76",color:"#163971",fontWeight:600,fontSize:"12px",width:"100%",display:"flex",justifyItems:"center",alignItems:"center",marginTop:1},Box:{marginLeft:10,marginTop:10,width:"95%",display:"flex",alignItems:"center",justifyContent:"flex-end"},TextArea:{width:"95%",height:100,marginLeft:10,display:"flex","& .textbox-text ":{fontSize:"12px !important",backgroundColor:"#e0ffff"}},ButtonText:{fontSize:12,paddingBottom:2,fontWeight:500},TextBox1:{width:200,height:25,"& input":{fontSize:"12px !important"}},TextBox2:{width:200,height:25,"& input":{fontSize:"12px !important",backgroundColor:"#e0ffff"}},TextBox3:{height:25,width:40,marginRight:5,"& input":{fontSize:"12px !important"}},TextBox4:{height:25,width:130,marginRight:5,"& input":{fontSize:"12px !important"}},DateTitleBox:{margin:"0px 5px 0px 15px",backgroundColor:"#e0ecff",padding:5,color:"#163971",height:25,fontSize:"12px",display:"flex",width:75,alignItems:"center",fontWeight:600},DateTitleBox2:{margin:"0px 5px 0px 15px",backgroundColor:"#e0ecff",padding:5,color:"#163971",height:25,fontSize:"12px",display:"flex",width:120,alignItems:"center",fontWeight:600}},$=U(j),J=[{fieldName:"FileSeq",dataType:x.exports.ValueType.TEXT},{fieldName:"SortSeq",dataType:x.exports.ValueType.TEXT},{fieldName:"FilePath",dataType:x.exports.ValueType.TEXT},{fieldName:"FileName",dataType:x.exports.ValueType.TEXT},{fieldName:"OriginalFileName",dataType:x.exports.ValueType.TEXT},{fieldName:"FileSize",dataType:x.exports.ValueType.NUMBER}],K=[{name:"SortSeq",fieldName:"SortSeq",width:35,styleName:"center-column",editable:!1,header:{text:"\uC21C\uBC88",showTooltip:!0},renderer:{type:"text",showTooltip:!0},numberFormat:"#,##0"},{name:"FilePath",fieldName:"FilePath",width:100,styleName:"left-column",editable:!0,visible:!1,header:{text:"\uD30C\uC77C\uACBD\uB85C",showTooltip:!0},renderer:{type:"text",showTooltip:!0}},{name:"FileName",fieldName:"FileName",width:200,styleName:"left-column",editable:!0,header:{text:"\uD30C\uC77C\uBA85",showTooltip:!0},renderer:{type:"text",showTooltip:!0}},{name:"OriginalFileName",fieldName:"OriginalFileName",width:150,editable:!1,styleName:"left-column",header:{text:"\uC6D0\uBCF8 \uD30C\uC77C\uBA85",showTooltip:!0},renderer:{type:"text",showTooltip:!0}},{name:"FileSize",fieldName:"FileSize",width:100,styleName:"right-column",editable:!1,numberFormat:"#,###,###,##0",header:{text:"\uD30C\uC77C\uD06C\uAE30(KB)",showTooltip:!0},renderer:{type:"text",showTooltip:!0}},{name:"Download",fieldName:"Download",type:"data",width:50,header:{text:"\uB2E4\uC6B4\uB85C\uB4DC"},editable:!1,styleName:"center-column center_custom_renderer",renderer:"Renderer_FileBtn"},{name:"FileDelete",fieldName:"FileDelete",type:"data",width:50,header:{text:"\uC0AD\uC81C"},editable:!1,styleName:"center-column center_custom_renderer",renderer:"Renderer_FileDeleteBtn"}],Q=b(({PGMID:o,FileType:B,FileNo:c,RevNo:m,Retrieve:d,GetDataSource:D})=>{const{$UserStore:u}=R(),r=y.exports.useRef(null),[C,p]=y.exports.useState({visible:!1,desc:"",type:"N"}),i=new I(o,p,!0,!0,!0,!0,!1),w=()=>{i.Grid.fContainerInit(i.Common.fMakeId("Grid1")),T=new x.exports.LocalDataProvider(!1),E=new x.exports.GridView(r.current),i.Grid.fInitGridHeader(E,T,J,K,27),E.setRowIndicator({visible:!1}),E.setEditOptions({editable:!0,appendable:!1}),E.registerCustomRenderer("Renderer_FileBtn",{initContent:function(t){t.appendChild(this._downloadButtn=document.createElement("span"))},canClick:function(){return!0},clearContent:function(t){t.innerHTML=""},render:function(t,a){this._fileSeq=t.getValue(a.index._itemIndex,"FileSeq"),this._filePath=t.getValue(a.index._itemIndex,"FilePath"),this._fileName=t.getValue(a.index._itemIndex,"FileName"),this._originalfileName=t.getValue(a.index._itemIndex,"OriginalFileName"),this._downloadButtn.className="grid_fileDown_button"},click:function(t){if(t.preventDefault,t.target===this._downloadButtn){var a=document.createElement("a");a.download=this._originalfileName,a.href=i.Common.fGetFilePath(this._filePath)+"/"+this._fileName,a.click()}}}),E.registerCustomRenderer("Renderer_FileDeleteBtn",{initContent:function(t){t.appendChild(this._deleteBtn=document.createElement("span"))},canClick:function(){return!0},clearContent:function(t){t.innerHTML=""},render:function(t,a){this._fileSeq=t.getValue(a.index._itemIndex,"FileSeq"),this._filePath=t.getValue(a.index._itemIndex,"FilePath"),this._fileName=t.getValue(a.index._itemIndex,"FileName"),this._originalfileName=t.getValue(a.index._itemIndex,"OriginalFileName"),this._deleteBtn.className="grid_filedelete_button"},click:async function(t){if(t.preventDefault,t.target===this._deleteBtn)try{const a={};a.FilePath=this._filePath,a.FileName=this._fileName,await N.post("/@api/common/attachments/deleteByFile",{data:a}),a.FileType=B,a.FileNo=c,a.RevNo=m,a.FileSeq=this._fileSeq,a.Factory=u.user.factory;const F=(await N.post("/@api/common/attachments/deleteByAttachments",{data:a})).data;F.errmess===""?setTimeout(()=>{f()},50):p({visible:!0,desc:F.errmess,type:"W"})}catch{p({visible:!0,desc:"\uCCA8\uBD80\uD30C\uC77C \uC0AD\uC81C\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4.",type:"E"})}}})},f=async()=>{if(i.Common.fValidate(i.Common.fEmptyReturn(B)===""||i.Common.fEmptyReturn(c)==="","\uCCA8\uBD80\uD30C\uC77C\uC744 \uC870\uD68C\uD560 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."))return;const t={};t.FileType=B,t.FileNo=c,t.RevNo=m,t.UserPno=u.user.userid,t.Factory=u.user.factory;try{const a=await i.Command.fSearchByReturnTrim("/@api/common/attachments/selectByAttachments",t);a?(T.setRows(a),D(T)):T.clearRows()}catch(a){p({visible:!0,desc:`\uC870\uD68C \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4..${a}`})}};return y.exports.useEffect(()=>{w(),f()},[]),y.exports.useEffect(()=>{i.Common.fEmptyReturn(d)!==""&&f()},[d]),e.createElement(e.Fragment,null,e.createElement(n,{ref:r,id:i.Common.fMakeId("Grid1"),style:{width:"100%",height:269}}),e.createElement(z,{visible:C.visible,description:C.desc,type:C.type,onConfirm:()=>p({visible:!1})}))});let T,E;const ae=b(({PGMID:o,FileTitle:B,FileType:c,FileNo:m,RevNo:d,FilePath:D,IsRevision:u,setClose:r})=>{const C=o+"_ATTACHMENTS",{$UserStore:p}=R(),i=y.exports.useRef(null),[w,f]=y.exports.useState({visible:!1,desc:"",type:"N"}),t=new I(o,f,!0,!0,!0,!0,!1),[a,S]=y.exports.useState({Retrieve:!1}),F=()=>e.createElement(n,{key:"Attach",style:{display:"flex",alignItems:"center"}},e.createElement("img",{src:q,alt:"logo",style:{marginLeft:5,width:27}}),e.createElement("pre",{disabled:!0,style:{margin:"3px 10px",fontWeight:"bold",color:"#898989"}},"\uCCA8\uBD80\uD30C\uC77C")),V=async l=>{!l||l.forEach(async h=>{if(t.Common.fValidate(!m,"\uC2E0\uADDC \uC790\uB8CC\uB294 \uC800\uC7A5 \uD6C4 \uCCA8\uBD80\uD30C\uC77C\uC744 \uB4F1\uB85D\uD574 \uC8FC\uC138\uC694."))return;if(h.name.length>76){f({visible:!0,desc:"\uD30C\uC77C\uBA85\uC774 \uB108\uBB34 \uAE41\uB2C8\uB2E4. \uD30C\uC77C\uBA85\uC744 \uBCC0\uACBD\uD558\uC5EC \uC8FC\uC138\uC694.",type:"W"});return}let v=new FormData;l.length>0&&v.append("file",h);try{const M=(await N.post("/@api/common/attachments/insertByFile",v,{headers:{"Content-Type":"multipart/form-data"},params:{upath:D}})).data.find(O=>O.originalname===h.name).filename,s={};s.FileType=c,s.FileNo=m,s.RevNo=u?d:0,s.FilePath=D,s.FileName=M,s.OriginalName=h.name,s.FileSize=h.size,s.UserPno=p.user.userid,s.Factory=p.user.factory;const A=(await N.post("/@api/common/attachments/insertByAttachments",{data:s})).data;A.errmess===""?setTimeout(()=>{t.Common.fFieldChange(S,"Retrieve",!a.Retrieve)},50):f({visible:!0,desc:A.errmess,type:"W"})}catch{f({visible:!0,desc:"\uCCA8\uBD80\uD30C\uC77C \uB4F1\uB85D\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4.",type:"E"})}})},k=()=>{!i.current||i.current.getJsonRows().forEach(l=>{var h=document.createElement("a");h.download=l.OriginalFileName,h.href=t.Common.fGetFilePath(l.FilePath)+"/"+l.FileName,h.click()})},P=l=>{l!=null&&l!=null&&(i.current=l)},G=()=>{r(i.current?i.current.getJsonRows().length:0)};return e.createElement(e.Fragment,null,e.createElement(g.exports.Dialog,{header:F,style:{width:800,height:400},closable:!1,modal:!0},e.createElement(n,{style:{height:309}},e.createElement(X,{FileTitle:B,FileType:c,FileNo:m,IsRevision:u,RevNo:u?d:0,onUploadFile:V,onDownloadFile:k}),e.createElement(Q,{PGMID:C,FileType:c,FileNo:m,RevNo:u?d:0,Retrieve:a.Retrieve,GetDataSource:P})),e.createElement(n,{className:"dialog-button"},e.createElement(g.exports.LinkButton,{style:{width:80},onClick:G},"\uB2EB\uAE30"))),e.createElement(z,{visible:w.visible,description:w.desc,type:w.type,onConfirm:()=>f({visible:!1})}))});export{ae as A};
