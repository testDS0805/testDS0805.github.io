import{r as g,R as t}from"./index.da6908f5.js";import{m as C,u as P,h as E,d as L,o as O,f as J,B as f,c as W,U as j,P as Z,r as v,C as _,A as ee}from"./App.11263b70.js";import{C as te}from"./CommonButton.0b792d77.js";import{C as U}from"./CommonDatePicker.d7bc57f8.js";import{C as $}from"./CodeHelperPopup.3932fdb9.js";import"./index.6f186c21.js";const ae=[{fieldName:"CustNm",dataType:C.exports.ValueType.TEXT},{fieldName:"CustCd",dataType:C.exports.ValueType.TEXT},{fieldName:"SupNo",dataType:C.exports.ValueType.TEXT},{fieldName:"SupSeq",dataType:C.exports.ValueType.TEXT},{fieldName:"BalNo",dataType:C.exports.ValueType.TEXT},{fieldName:"BalSeq",dataType:C.exports.ValueType.TEXT},{fieldName:"SupplyDate",dataType:C.exports.ValueType.TEXT},{fieldName:"GoodCd",dataType:C.exports.ValueType.TEXT},{fieldName:"GoodNo",dataType:C.exports.ValueType.TEXT},{fieldName:"GoodNm",dataType:C.exports.ValueType.TEXT},{fieldName:"Spec",dataType:C.exports.ValueType.TEXT},{fieldName:"UnitNm",dataType:C.exports.ValueType.TEXT},{fieldName:"NapQty",dataType:C.exports.ValueType.NUMBER},{fieldName:"Qty",dataType:C.exports.ValueType.NUMBER},{fieldName:"Su",dataType:C.exports.ValueType.NUMBER},{fieldName:"QcOkQty",dataType:C.exports.ValueType.NUMBER},{fieldName:"QcErrorQty",dataType:C.exports.ValueType.NUMBER},{fieldName:"QcErrorDesc",dataType:C.exports.ValueType.TEXT},{fieldName:"QcErrorDescNm",dataType:C.exports.ValueType.TEXT},{fieldName:"QcDate",dataType:C.exports.ValueType.TEXT},{fieldName:"Complate",dataType:C.exports.ValueType.TEXT}],ue=[{fieldName:"CustNm",type:"data",width:95,editable:!1,styleName:"center-column",renderer:{type:"text",showTooltip:!0},header:{text:"\uC5C5\uCCB4\uBA85"}},{fieldName:"SupNo",type:"data",width:95,editable:!1,header:{text:"\uB0A9\uD488\uBC88\uD638"},styleName:"center-column"},{fieldName:"SupplyDate",type:"data",width:60,editable:!1,header:{text:"\uB0A9\uD488\uC77C\uC790"},styleName:"center-column"},{fieldName:"GoodNo",type:"data",width:160,editable:!1,header:{text:"\uD488\uBC88"},renderer:{type:"text",showTooltip:!0},styleName:"left-column"},{fieldName:"GoodNm",type:"data",width:160,editable:!1,header:{text:"\uD488\uBA85"},styleName:"left-column"},{fieldName:"Spec",type:"data",width:160,editable:!1,header:{text:"\uADDC\uACA9"},styleName:"left-column"},{fieldName:"UnitNm",type:"data",width:40,editable:!1,header:{text:"\uB2E8\uC704"},styleName:"center-column"},{fieldName:"NapQty",type:"data",width:60,editable:!1,numberFormat:"#,##0.##",header:{text:"\uB0A9\uD488\uB7C9"},styleName:"right-column"},{fieldName:"Qty",type:"data",width:60,editable:!1,numberFormat:"#,##0.##",header:{text:"\uC911\uB7C9"},styleName:"right-column"},{fieldName:"Su",type:"data",width:60,editable:!1,numberFormat:"#,##0.##",header:{text:"\uAE38\uC774"},styleName:"right-column"},{fieldName:"QcOkQty",type:"data",width:60,editable:!1,numberFormat:"#,##0.##",header:{text:"\uD569\uACA9\uC218\uB7C9"},styleName:"right-column"},{fieldName:"QcErrorQty",type:"data",width:60,numberFormat:"#,##0.##",header:{text:"\uBD88\uB7C9\uC218\uB7C9"},editor:{type:"number",editFormat:"#,##0.##"},styleName:"right-column rg-text-red-color"},{fieldName:"QcErrorDescNm",type:"data",width:60,button:"action",header:{text:"\uBD88\uB7C9\uC0AC\uC720"},styleName:"center-column rg-text-red-color"},{fieldName:"QcDate",type:"data",width:60,editable:!1,header:{text:"\uAC80\uC0AC\uB0A0\uC9DC"},styleName:"center-column "},{fieldName:"Complate",type:"data",width:60,editable:!1,header:{text:"\uC644\uB8CC\uAD6C\uBD84"},styleName:"center-column "}];function q(){const{$UserStore:e}=P(),[r,D]=g.exports.useState({SchAccunit:e.user.accunit,SchFactory:e.user.factory,SchPno:e.user.userid,SchPnoNm:e.user.username.trim(),SchQcComplate:"1",SchFrDate:E().subtract(1,"month"),SchToDate:new Date,SchQcDate:new Date,SchSupNo:"",SchCustCd:"",SchCustNm:""}),[u,a]=g.exports.useState({visible:!1,description:"",value:"",datas:{},id:"",viewId:"",selectedData:{}}),[o,y]=g.exports.useState(""),[l,d]=g.exports.useState({visible:!1,desc:"",type:"N"}),[N,I]=g.exports.useState({visible:!1,desc:"",id:""});return{searchVO:r,setSearchVO:D,alert:l,setAlert:d,confirm:N,setConfirm:I,gridFocus:o,setGridFocus:y,codeClassInputs:u,setCodeClassInputs:a}}const le=(e,r)=>{e({SchAccunit:r.user.accunit,SchFactory:r.user.factory,SchPno:r.user.userid,SchPnoNm:r.user.username.trim(),SchQcComplate:"0",SchFrDate:E().subtract(1,"month"),SchToDate:new Date,SchQcDate:new Date,SchSupNo:"",SchCustCd:"",SchCustNm:""})},X=async(e,r,D,u,a)=>{if(e.Util.Common.fValidate(!E(r.SchFrDate,"YYYY-MM-DD").isValid()||!E(r.SchToDate,"YYYY-MM-DD").isValid(),"\uC870\uD68C\uAE30\uAC04\uC744 \uBC14\uB974\uAC8C \uC785\uB825\uD574 \uC8FC\uC138\uC694.")||e.Util.Common.fValidate(E(r.SchFrDate).format("YYYYMMDD")>E(r.SchToDate).format("YYYYMMDD"),"\uC870\uD68C\uAE30\uAC04\uC744 \uD655\uC778\uD558\uC138\uC694."))return;const o={...r};o.SchFrDate=E(o.SchFrDate).format("YYYYMMDD"),o.SchToDate=E(o.SchToDate).format("YYYYMMDD"),a&&(o.SchQcComplate="0"),await e.Util.Command.fSearch(D,"/@api/quality/qcDelv/selectByList",o,u)},K=async(e,r,D,u)=>{try{const a=await L.get("@api/purchase/purchaseStorage/searchConvertValue",{params:{SchGoodcd:u,SchConvertUnit:D,SchConvertValue:r}});if(!a.data)return;if(a.data.returnValue!==0)return a.data.returnValue}catch{e.setAlert({visible:!0,desc:"\uB2E8\uC704 \uD658\uC0B0 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4."})}},se=async(e,r,D,u)=>{u.commit();const a={...r};let o=[];o=u.getCheckedItems(!0);let y=[];o.forEach(l=>{const d=D.getJsonRow(l);y.push(d)}),y.forEach(l=>{for(const[d,N]of Object.entries(l))typeof l[d]=="string"&&(l[d]=N.trim())});try{const d=(await L.post("/@api/quality/QcDelv/updateByList",{header:a,detail:y})).data;if(d.errmess!==""){e.setAlert({visible:!0,desc:d.errmess,type:"W"});return}e.setAlert({visible:!0,desc:"\uAC80\uC0AC\uC2E4\uC801\uC774 \uC800\uC7A5\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),setTimeout(async()=>{await X(e,r,D,"","fromSave")},100)}catch(l){e.setAlert({visible:!0,desc:`\uC800\uC7A5 \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4. ${l}`})}},re=async(e,r,D,u)=>{u.commit();const a={...r};let o=[];o=u.getCheckedItems(!0);let y=[];o.forEach(l=>{const d=D.getJsonRow(l);y.push(d)}),y.forEach(l=>{l.QcDate?l.QcDate=E(l.QcDate).format("YYYYMMDD"):l.QcDate=""});try{const d=(await L.post("/@api/quality/QcDelv/updateByDelete",{header:a,detail:y})).data;if(d.errmess!==""){e.setAlert({visible:!0,desc:d.errmess,type:"W"});return}e.setAlert({visible:!0,desc:"\uAC80\uC0AC\uC2E4\uC801 \uC0AD\uC81C\uAC00 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),setTimeout(async()=>{await X(e,r,D,"","fromSave")},100)}catch(l){e.setAlert({visible:!0,desc:`\uC0AD\uC81C \uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4. ${l}`})}},oe={SC1:{width:100,height:25,margin:"3px 10px",backgroundColor:"#e0ecff",color:"#163971",padding:5,fontSize:"12px",alignItems:"center",fontWeight:600,display:"flex"},SC4:{display:"flex",alignItems:"center"},Radio:{width:15,height:15},RadioLabel:{width:50,marginLeft:5,fontSize:"14px"},SC3:{width:180,height:25,"& input":{fontSize:"12px !important"}}},ie=O(e=>{const r="QCDELV",{setAlert:D,codeClassInputs:u,setCodeClassInputs:a}=q(),o=["QcErrorDescNm"],y=g.exports.useRef(null),{$CommonStore:l,$UserStore:d}=P(),[N]=g.exports.useState({setAlert:D}),I=async()=>{p.commit(!0);const s=u.selectedData;s.dataRow;const B=l.Codeclass.selData;m.getJsonRow(s.dataRow),s.column==="QcErrorDescNm"&&e.Util.Grid.fSetMultiDataProvider(m,s.dataRow,{QcErrorDescNm:B.minornm.trim(),QcErrorDesc:B.minorcd}),a({visible:!1,desc:"",value:"",datas:{},selectedData:{},id:"",viewId:""}),p.commit(!0),p.validateCells(),p.setFocus()},k=()=>{const s=p.getCurrent().itemIndex;p.setCurrent({itemIndex:s,fieldName:p.getCurrent().fieldName}),p.setFocus(),p.validateCells(),a({visible:!1})},i=async()=>{e.Util.Grid.fContainerInit(e.Util.Common.fMakeId(e.Id)),m=new C.exports.LocalDataProvider(!1),p=new C.exports.GridView(y.current),e.Util.Grid.fInitGridDetail(p,m,e.GridFields,e.GridColumns,F,R,M),p.setRowIndicator({visible:!0}),p.setDisplayOptions({fitStyle:"fill",rowHeight:25}),p.setCheckBar({visible:!1}),p.setCheckBar({visible:!0}),e.DataProviderBind(m),e.GridViewBind(p),p.setRowStyleCallback((s,B)=>{if(s.getValue(B.index,"Complate")==="\uAC80\uC0AC\uC644\uB8CC")return"rg-column-color-1"})},F=async(s,B)=>{s.commit(),e.setGridFocus("D");const c=s.getValue(s.getCurrent().itemIndex,B.fieldName);let h={};B.fieldName==="QcErrorDescNm"&&(h=await e.Util.Grid.gridCodeClass(s.getCurrent(),e.Util.CodeHelper.helperIntype,r,c,!0)),a(h)},R=async s=>{s.commit();const{column:B,dataRow:c}=s.getCurrent(),h=s.getValue(c,B),S=m.getValue(c,"NapQty");if(B==="QcErrorQty")if(h<0){p.setCurrent({i:c,column:"QcErrorQty"}),e.setAlert({visible:!0,desc:"0\uBCF4\uB2E4 \uC791\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."}),m.setValue(c,"QcErrorQty",S);return}else if(h>S){p.setCurrent({i:c,column:"QcErrorQty"}),e.setAlert({visible:!0,desc:"\uBD88\uB7C9 \uC218\uB7C9\uC744 \uD655\uC778\uD558\uC138\uC694."}),m.setValue(c,"QcErrorQty",0);return}else if(m.getValue(c,"UnitNm")==="M"){m.setValue(c,"Su",S-h),m.setValue(c,"QcOkQty",S-h);const A=m.getValue(c,"GoodCd"),T=await K(N,S-h,"Kg",A);m.setValue(c,"Qty",T)}else m.setValue(c,"Qty",S-h),m.setValue(c,"QcOkQty",S-h);if(B==="QcErrorQty"&&h===0){const A=m.getValue(c,"GoodCd"),T=await K(N,S-h,"Kg",A);m.setValue(c,"Qty",T),m.setValue(c,"QcErrorDescNm",""),m.setValue(c,"QcErrorDesc","")}},M=async(s,B)=>{const{fieldName:c}=s.getCurrent(),h={fieldName:c};switch(B.key){case"Enter":if(e.setAlert({visible:!1,desc:""}),s.commit(!0),o.includes(c)){const{fieldName:S,itemIndex:A}=s.getCurrent(),T=s.getValue(A,S);let V={};if(T!==""&&T!==void 0){if(S==="QcErrorDescNm"&&(V=await e.Util.Grid.gridCodeClass(s.getCurrent(),e.Util.CodeHelper.helperIntype,r,T,!1),!V.visible)){const Y=V.res;e.Util.Grid.fSetMultiDataProvider(m,A,{QcErrorDescNm:Y.minornm.trim(),QcErrorDesc:Y.minorcd})}a(V),p.validateCells()}}s.setFocus();break;case(B.ctrlKey&&" "):F(s,h);break}};return g.exports.useEffect(()=>{i()},[]),t.createElement(t.Fragment,null,t.createElement(J,{visible:u.visible,description:u.desc,value:u.value,datas:u.datas,id:u.id,viewId:u.viewId,selectedData:u.selectedData,onConfirm:I,onCancel:()=>k({target:u.id})}),t.createElement(f,{ref:y,key:e.Util.Common.fMakeId(e.Id),id:e.Util.Common.fMakeId(e.Id),style:{width:"99.99999%",height:700}}))});let m,p;const he=O(()=>{const e="QCDELV",{$CommonStore:r,$UserStore:D}=P(),u=ne(),{searchVO:a,setSearchVO:o,alert:y,setAlert:l,confirm:d,setConfirm:N,gridFocus:I,setGridFocus:k}=q(),i=new j(e,l,!0,!0,!0,!0,!0),F=n=>{Q=n},R=n=>{w=n},M=()=>{le(o,D)},[s]=g.exports.useState({Util:i,User:D,fInit:M,setAlert:l}),B=()=>(w.getAllStateRows().created.length>0,0),c=()=>{i.Grid.fTab(Q,B()===0,"No")},h=async()=>{},S=async()=>{await X(s,a,w,"\uB0A9\uD488 \uBAA9\uB85D")},A=async()=>{if(Q.commit(),w.getJsonRows().length<=0){l({visible:!0,desc:"\uB4F1\uB85D\uD560 \uC790\uB8CC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4"});return}if(i.Common.fValidate(Q.getCheckedItems(!0).length<1,"\uAC80\uC0AC\uB4F1\uB85D\uD560 \uB0B4\uC5ED \uCCB4\uD06C\uD558\uC138\uC694."))return;let n=[];n=Q.getCheckedItems(!0);let b=[];if(n.forEach(x=>{const z=w.getJsonRow(x);b.push(z)}),b.some(x=>x.QcErrorQty!==0&&x.QcErrorDescNm==="")){l({visible:!0,desc:"\uBD88\uB7C9\uC0AC\uC720\uB97C \uC785\uB825\uD558\uC138\uC694"});return}if(b.some(x=>x.SupplyDate>E(a.SchQcDate).format("YYYY-MM-DD"))){l({visible:!0,desc:"\uAC80\uC0AC\uB0A0\uC9DC\uAC00 \uB0A9\uD488\uB0A0\uC9DC\uBCF4\uB2E4 \uB354 \uBE60\uB97C \uC218 \uC5C6\uC2B5\uB2C8\uB2E4."});return}n.forEach(x=>{w.setValue(x,"QcDate",E(a.SchQcDate).format("YYYYMMDD"))}),N({visible:!0,desc:E(a.SchQcDate).format("YYYY-MM-DD")+" \uB0A0\uC9DC\uC5D0 \uAC80\uC0AC \uC2E4\uC801\uC744 \uB4F1\uB85D\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",id:"SAVE"})},T=async()=>{i.Common.fValidate(Q.getCheckedItems(!0).length<1,"\uC0AD\uC81C\uD560 \uB0B4\uC5ED \uCCB4\uD06C\uD558\uC138\uC694.")||N({visible:!0,desc:"\uAC80\uC0AC\uC2E4\uC801\uC744 \uC0AD\uC81C\uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",id:"DELETE"})},V=async()=>{N({visible:!1,desc:"",id:""}),d.id==="SAVE"?(o({...a,SchQcComplate:"0"}),await se(s,a,w,Q)):d.id==="DELETE"&&(o({...a,SchQcComplate:"0"}),await re(s,a,w,Q))},Y=()=>{N({visible:!1,desc:"",id:""})},H=(n,b,x)=>{switch(n){case"schCustNm":i.Common.fMultiFieldChange(o,{SchCustCd:b,SchCustNm:x});break;case"SchPno":i.Common.fMultiFieldChange(o,{SchPno:b,SchPnoNm:x});break}},G=(n,b)=>{b&&o({...a,SchQcComplate:n})};return g.exports.useEffect(()=>{i.Common.fHotKey(r,r.isPopup,h,S,A,T)},[r.HotKey]),g.exports.useEffect(()=>(M(),()=>{r.fSetHotKey()}),[]),t.createElement(t.Fragment,null,t.createElement(te,{pgmid:e,visible:"01110",onNew:h,onSearch:S,onSave:A,onDelete:T}),t.createElement(Z,{className:"mainCon"},t.createElement(f,{display:"flex",flexDirection:"column",alignItems:"flex-start",style:{padding:1,border:"1px solid #e2e2e2",borderRadius:5,backgroundColor:"#f9f9f9"}},t.createElement(f,{style:{display:"flex",alignItems:"center "}},t.createElement(f,{style:{marginTop:2,marginLeft:0,display:"flex",alignItems:"center"}},t.createElement(f,{className:u.SC4},t.createElement(f,{className:u.SC1},"\uB0A9\uD488\uB0A0\uC9DC\uC870\uD68C"),t.createElement(U,{inputCls:"inputCls",selected:a.SchFrDate,inputId:i.Common.fMakeId("SchFrDate"),onHandleDateChange:n=>i.Common.fFieldChange(o,"SchFrDate",n)}),t.createElement(f,{style:{margin:"0 3px",width:"10px"}},"~"),t.createElement(U,{inputCls:"inputCls",selected:a.SchToDate,inputId:i.Common.fMakeId("SchToDate"),onHandleDateChange:n=>i.Common.fFieldChange(o,"SchToDate",n)}))),t.createElement(f,{style:{marginTop:2,marginLeft:5,display:"flex",alignItems:"center"}},t.createElement(f,{className:u.SC4},t.createElement(f,{className:u.SC1},"\uAC80\uC0AC\uC870\uD68C\uAD6C\uBD84")),t.createElement(f,{style:{height:27,display:"flex",flexDirection:"row",border:"1px solid #9ac9ed",borderRadius:5,alignItems:"center",justifyContent:"center"}},t.createElement(v.exports.RadioButton,{className:u.Radio,inputId:i.Common.fMakeId("all"),inputCls:"inputCls",value:"0",groupValue:a.SchQcComplate,onChange:n=>G("0",n),style:{marginLeft:5}}),t.createElement(v.exports.Label,{htmlFor:i.Common.fMakeId("all"),className:u.RadioLabel},"\uC804\uCCB4"),t.createElement(f,null,t.createElement(v.exports.RadioButton,{className:u.Radio,inputId:i.Common.fMakeId("mi"),inputCls:"inputCls",value:"1",groupValue:a.SchQcComplate,onChange:n=>G("1",n),style:{marginLeft:5}}),t.createElement(v.exports.Label,{htmlFor:i.Common.fMakeId("mi"),className:u.RadioLabel},"\uBBF8\uAC80\uC0AC")),t.createElement(f,null,t.createElement(v.exports.RadioButton,{className:u.Radio,inputId:i.Common.fMakeId("done"),inputCls:"inputCls",value:"2",groupValue:a.SchQcComplate,onChange:n=>G("2",n),style:{marginLeft:5}}),t.createElement(v.exports.Label,{htmlFor:i.Common.fMakeId("done"),className:u.RadioLabel},"\uAC80\uC0AC")))),t.createElement(f,{style:{marginTop:2,marginLeft:5,display:"flex",alignItems:"center"}},t.createElement(f,{className:u.SC4},t.createElement(f,{className:u.SC1},"\uC870\uD68C\uB0A9\uD488\uBC88\uD638")),t.createElement(v.exports.TextBox,{inputId:i.Common.fMakeId("SchSupNo"),inputCls:"inputCls",className:u.SC3,onChange:n=>{i.Common.fFieldChange(o,"SchSupNo",n)},value:a.SchSupNo})),t.createElement($,{title:"\uAC70\uB798\uCC98",inputCls:"inputCls",pgmid:e,inputType:"Cust",id:"schCustNm",helper:i.CodeHelper.helperCust,ComponentCode:a.SchCustCd,ComponentValue:a.SchCustNm,SetValue:H,labelStyles:{width:70,height:25,margin:"0px 3px 5px 10px",padding:5,fontSize:12,display:"flex",alignItems:"center",fontWeight:600},inputStyles:{width:150,margin:"0px 0px 5px 7px"}})),t.createElement(f,{style:{display:"flex",alignItems:"center "}},t.createElement(f,{className:u.SC4},t.createElement(f,{className:u.SC1},"\uAC80\uC0AC\uB0A0\uC9DC\uC785\uB825"),t.createElement(U,{inputCls:"inputCls",selected:a.SchQcDate,inputId:i.Common.fMakeId("SchQcDate"),onHandleDateChange:n=>i.Common.fFieldChange(o,"SchQcDate",n)})),t.createElement($,{title:"\uC785\uB825\uC790",inputCls:"inputCls",pgmid:e,inputType:"Pno",id:"SchPno",helper:i.CodeHelper.helperPnoNm,ComponentCode:a.SchPno,ComponentValue:a.SchPnoNm,SetValue:H,labelStyles:{width:70,height:25,margin:"0px 1px 5px 10px",padding:5,fontSize:12,display:"flex",alignItems:"center",fontWeight:600},inputStyles:{width:150,margin:"0px 0px 3px 1px"}}))),t.createElement(f,{style:{marginTop:5}},t.createElement(ie,{Util:i,Id:"Grid1",GridFields:ae,GridColumns:ue,setGridFocus:k,setAlert:l,TabGrid:c,DataProviderBind:R,GridViewBind:F}))),t.createElement(_,{visible:d.visible,description:d.desc,onCancel:Y,onConfirm:V}),t.createElement(ee,{visible:y.visible,description:y.desc,type:y.type,onConfirm:()=>l({visible:!1})}))});let Q,w;const ne=W(oe);export{he as default};
