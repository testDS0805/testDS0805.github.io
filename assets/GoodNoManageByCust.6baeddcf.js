import{r as u,R as o}from"./index.da6908f5.js";import{m as r,o as Y,c as j,u as J,P as Z,B as l,r as w,A as _,C as ee,f as te,d as B,i as oe,D as ae}from"./App.11263b70.js";import{g as se}from"./GridCtrl.5c3948f6.js";import{C as ie}from"./CommonButton.0b792d77.js";import{T as ne}from"./Toast.7cbbb43f.js";const ue=[{fieldName:"NaraeGoodno",dataType:r.exports.ValueType.TEXT},{fieldName:"Goodno",dataType:r.exports.ValueType.TEXT},{fieldName:"Goodcd",dataType:r.exports.ValueType.TEXT},{fieldName:"UniGoodno",dataType:r.exports.ValueType.TEXT},{fieldName:"Price",dataType:r.exports.ValueType.NUMBER},{fieldName:"Remark",dataType:r.exports.ValueType.TEXT},{fieldName:"Crepno",dataType:r.exports.ValueType.TEXT},{fieldName:"Credate",dataType:r.exports.ValueType.TEXT},{fieldName:"Modpno",dataType:r.exports.ValueType.TEXT},{fieldName:"Moddate",dataType:r.exports.ValueType.TEXT}],re=[{name:"NaraeGoodno",fieldName:"NaraeGoodno",type:"data",width:120,editable:!0,styleName:"left-column",header:{text:"\uACE0\uAC1D \uD488\uBC88"},renderer:{type:"text",showTooltip:!1}},{name:"Goodno",fieldName:"Goodno",type:"data",width:250,editable:!0,styleName:"left-column",button:"action",header:{text:"ERP \uD488\uBC88"},renderer:{type:"text",showTooltip:!1},editor:{type:"line",textCase:"upper"}},{name:"UniGoodno",fieldName:"UniGoodno",type:"data",width:120,editable:!0,styleName:"left-column",header:{text:"\uC720\uB2C8\uB77D \uD488\uBC88"},renderer:{type:"text",showTooltip:!1}},{name:"Price",fieldName:"Price",type:"data",width:120,editable:!0,styleName:"right-column",header:{text:"\uB2E8\uAC00"},numberFormat:"#,##0",renderer:{type:"text",showTooltip:!0},editor:{type:"number"}},{name:"Remark",fieldName:"Remark",type:"data",width:120,editable:!0,styleName:"left-column",header:{text:"\uBE44\uACE0"},renderer:{type:"text",showTooltip:!1}}],fe=Y(()=>{const{$CommonStore:g,$UserStore:F}=J(),n=le(),A="GOODNOMANAGEBYCUST",R=u.exports.useRef(null),[d,P]=u.exports.useState({custCd:"02434",custGoodNo:"",erpGoodNo:"",uniGoodNo:""}),[M,L]=u.exports.useState([]),[E,O]=u.exports.useState(0),[f,N]=u.exports.useState({visible:!1,description:"",value:"",datas:{},id:"",viewId:"",selectedData:{}}),[I,U]=u.exports.useState({visible:!1,desc:"",type:"N"}),[D,c]=u.exports.useState({visible:!1,desc:"",type:"N"}),[T,v]=u.exports.useState({visible:!1,desc:"",id:""});let x={...ae};x.iInId="A114",x.iInCode1="001",x.iInCode2="00A",x.iInCode3="";const X=async()=>{try{let e=await B.get("/@api/business/goodnomanagebycust/selectByCustList");L(e.data)}catch{c({visible:!0,desc:"\uACE0\uAC1D\uC0AC \uC870\uD68C\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4."});return}},H=()=>{i=new r.exports.LocalDataProvider(!1),t=new r.exports.GridView(R.current),t.setDataSource(i),i.setFields(ue),t.setColumns(re),t.setCheckBar({visible:!1}),t.setStateBar({visible:!0}),t.setFooters({visible:!1}),t.setRowIndicator({visible:!0}),t.setDisplayOptions({fitStyle:"evenFill",rowHeight:25}),t.setOptions({summaryMode:"aggregate"}),t.setEditOptions({insertable:!0,appendable:!0,editable:!0}),t.onKeyDown=async function(e,C){let s=C.key,y=e.getItemCount();const p=i.getAllStateRows().created;(s==="ArrowRight"||s==="ArrowLeft"||s==="ArrowDown")&&e.commit(),s==="Enter"?(e.commit(!0),e.setFocus()):s==="Escape"&&y>0&&(e.cancel(),p.length!==0&&i.getRowState(e.getCurrent().itemIndex)!=="none"&&i.removeRow(e.getCurrent().itemIndex))},t.onCellButtonClicked=K,O(E+1)},K=async(e,C)=>{e.commit(!0);const s=e.getCurrent().itemIndex,y=C.fieldName;if(y==="Goodno"){const m=e.getValue(s,y);if(!m){c({visible:!0,desc:"\uD488\uBC88 \uC785\uB825 \uD6C4 \uC870\uD68C \uAC00\uB2A5\uD569\uB2C8\uB2E4."});return}let p={};x.iInCode3=m,p=await se(e.getCurrent(),x,A,m,!0),N(p)}},z=async()=>{t.commit();const e=f.selectedData;e.column==="Goodno"&&i.setValue(e.dataRow,e.column,g.Codeclass.selData.goodno),t.commit(),N({visible:!1,desc:"",value:"",datas:{},selectedData:{},id:"",viewId:""}),t.setFocus()},Q=()=>{const e=t.getCurrent().itemIndex;t.setCurrent({itemIndex:e,fieldName:"Goodno"}),t.setFocus(),N({visible:!1})},S=(e,C)=>{P(s=>({...s,[C]:e}))},V=async()=>{t.beginAppendRow(),t.showEditor(),t.setFocus()},h=async()=>{if(!d.custCd){c({visible:!0,desc:"\uACE0\uAC1D\uC0AC\uAC00 \uC81C\uB300\uB85C \uC785\uB825\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4."});return}W(),i.setRows([]);try{let e=await B.get("/@api/business/goodnomanagebycust/selectByInquiry",{params:d});i.setRows(e.data)}catch(e){e.response.status===404?c({visible:!0,desc:"\uC870\uD68C \uACB0\uACFC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4."}):c({visible:!0,desc:"\uC870\uD68C\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4.",type:"E"})}},k=async()=>{t.commit();const e=i.getAllStateRows(),C=e.created,s=e.updated;if(C.length===0&&s.length===0){c({visible:!0,desc:"\uC800\uC7A5\uD560 \uC790\uB8CC \uB610\uB294 \uC218\uC815\uD560 \uC790\uB8CC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4"});return}v({visible:!0,desc:"\uC800\uC7A5 \uD558\uC2DC\uACA0\uC2B5\uB2C8\uAE4C?",id:"SAVE"})},$=async()=>{const e=i.getAllStateRows(),C=e.created,s=e.updated,y=[];try{if(C.length>0)for(const m of C){let p=!1;const a=i.getValues(m);let G=await B.get("/@api/business/goodnomanagebycust/selectByErpList",{params:{iTag:"Q",iInId:"A114",iInCode1:"001",iInCode2:"00A",iInCode3:a[1],iInCode4:"",iInCode5:"",iInCode6:"",iFieldnm:null,iSort:null}});for(const b of G.data)a[1]===b&&(p=!0);if(p){let b=await B.get("/@api/business/goodnomanagebycust/selectByGoodcd",{params:{iTag:"Q",iInId:"A114",iInCode1:"001",iInCode2:"00A",iInCode3:a[1],iInCode4:"",iInCode5:"",iInCode6:"",iFieldnm:null,iSort:null}});await B.post("/@api/business/goodnomanagebycust/updateByList",{iNaraeGoodno:a[0],iGoodno:a[1],iGoodcd:b.data,iUniGoodno:a[3],iPrice:a[4],iRemark:a[5],iCrepno:F.user.userid,iModpno:a[8],iCustcd:d.custCd})}else y.push(m+1+" ")}if(s.length>0)for(const m of s){let p=!1;const a=i.getValues(m);let G=await B.get("/@api/business/goodnomanagebycust/selectByErpList",{params:{iTag:"Q",iInId:"A114",iInCode1:"001",iInCode2:"00A",iInCode3:a[1],iInCode4:"",iInCode5:"",iInCode6:"",iFieldnm:null,iSort:null}});for(const b of G.data)a[1]===b&&(p=!0);if(p){let b=await B.get("/@api/business/goodnomanagebycust/selectByGoodcd",{params:{iTag:"Q",iInId:"A114",iInCode1:"001",iInCode2:"00A",iInCode3:a[1],iInCode4:"",iInCode5:"",iInCode6:"",iFieldnm:null,iSort:null}});await B.post("/@api/business/goodnomanagebycust/updateByList",{iNaraeGoodno:a[0],iGoodno:a[1],iGoodcd:b.data,iUniGoodno:a[3],iPrice:a[4],iRemark:a[5],iCrepno:a[6],iModpno:a[8],iCustcd:d.custCd})}else y.push(m+1+" ")}if(y.length>0){c({visible:!0,desc:"\uC800\uC7A5\uC911 \uC2E4\uD328 \uB0B4\uC5ED\uC774 \uC788\uC2B5\uB2C8\uB2E4.",type:"E"});return}else c({visible:!0,desc:"\uC800\uC7A5\uC774 \uC644\uB8CC\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}),h()}catch{c({visible:!0,desc:"\uC800\uC7A5\uC911 \uC624\uB958\uAC00 \uBC1C\uC0DD\uD558\uC600\uC2B5\uB2C8\uB2E4.",type:"E"});return}},W=()=>{t.orderBy([],[])},q=async()=>{T.id==="SAVE"&&$(),v({visible:!1,desc:"",id:""})};return u.exports.useEffect(()=>{E>0&&(t.cancel(),h())},[E]),u.exports.useEffect(()=>{d.custCd&&E>0&&(t.cancel(),h())},[d.custCd]),u.exports.useEffect(()=>{g.HotKey&&g.HotKey.pgmid===A&&(g.HotKey.key==="NEW"?V():g.HotKey.key==="SEARCH"?(t.cancel(),h()):g.HotKey.key==="SAVE"&&k())},[g.HotKey]),u.exports.useEffect(()=>{X(),H()},[]),o.createElement(o.Fragment,null,o.createElement(ie,{pgmid:A,visible:"11100",onNew:V,onSearch:h,onSave:k}),o.createElement(Z,{className:"mainCon"},o.createElement(l,{style:{width:"100%",height:50,backgroundColor:"#f9f9f9",borderRadius:"5px",display:"flex",flexDirection:"row",padding:5}},o.createElement(l,{style:{display:"flex",alignItems:"center"}},o.createElement(l,{className:n.S1},o.createElement(l,{className:n.S2},"\uACE0\uAC1D\uC0AC")),o.createElement(w.exports.ComboBox,{className:n.S5,panelStyle:{height:100},data:M,value:d.custCd,editable:!1,onChange:e=>S(e,"custCd")}),o.createElement(l,{className:n.S1},o.createElement(l,{className:n.S2},"\uACE0\uAC1D\uD488\uBC88")),o.createElement(w.exports.TextBox,{placeholder:"\uACE0\uAC1D\uD488\uBC88",className:n.S4,value:d.custGoodNo,onChange:e=>S(e,"custGoodNo")}),o.createElement(l,{className:n.S1},o.createElement(l,{className:n.S2},"ERP\uD488\uBC88")),o.createElement(w.exports.TextBox,{placeholder:"ERP\uD488\uBC88",className:n.S4,value:d.erpGoodNo,onChange:e=>S(e,"erpGoodNo")}),o.createElement(l,{className:n.S1},o.createElement(l,{className:n.S2},"\uC720\uB2C8\uB77D\uD488\uBC88")),o.createElement(w.exports.TextBox,{placeholder:"\uC720\uB2C8\uB77D\uD488\uBC88",className:n.S4,value:d.uniGoodNo,onChange:e=>S(e,"uniGoodNo")}))),o.createElement(l,{ref:R,style:{width:"100%",height:720,marginTop:5}})),o.createElement(ne,{visible:I.visible,description:I.desc,type:I.type,onConfirm:()=>U({visible:!1})}),o.createElement(_,{visible:D.visible,description:D.desc,type:D.type,onConfirm:()=>c({visible:!1})}),o.createElement(ee,{visible:T.visible,description:T.desc,onCancel:()=>v({visible:!1}),onConfirm:q}),o.createElement(te,{visible:f.visible,description:f.desc,value:f.value,datas:f.datas,id:f.id,viewId:f.viewId,selectedData:f.selectedData,onConfirm:z,onCancel:Q}))});let i,t;const le=j({S1:{margin:"3px 10px",backgroundColor:"#e0ecff",color:"#163971",padding:5,height:25,fontSize:"12px",display:"flex",alignItems:"center",width:110,fontWeight:600},S2:{width:100},S3:{"& .textbox-text":{fontSize:"12px"},"& .textbox":{fontSize:"12px"},"& .combo-arrow":{backgroundImage:`url(${oe})`,backgroundRepeat:"no-repeat",backgroundColor:"#ffffff!important",height:12}},S4:{width:155,height:25,"& input":{fontSize:"12px !important"}},S5:{width:200,height:25,"& input":{fontSize:"12px !important"}},S6:{width:90,height:30,color:"#fff",borderRadius:3,paddingBottom:2},S7:{width:"15px!important",height:"15px!important"},S8:{width:65,height:20,margin:"0px 3px",display:"flex",alignItems:"center",fontSize:12}});export{fe as default};
